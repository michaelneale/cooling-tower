package jboss.cloud.elastic


#Can have Metric generic object - many of them?
#or a map on AppServer?
rule "All loaded up"
    when
        as: AppServer()
        exist: Metric(appServer == as, name=="cpuIdle")
        not Metric(appServer == as, name =="cpuIdle", value > 80)
    then
        requestNewApplicationServer("Connection busy")
end



rule "Empty server"
    when
        srv: Server()
        not AppServerInstance(server == srv)
    then
        shutdown(srv)
end


#more strongly typed??
rule "Can scale down"
    when
       srv: Server()
       as: AppServerInstance(sessionCount < 2, server == srv)
       exists AppServerInstance(sessionCount < 5, server != srv)
    then
       shutdownApplicationServer(as)
end


#and so on...
